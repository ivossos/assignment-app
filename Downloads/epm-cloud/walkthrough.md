# Oracle FCCS MCP Server Walkthrough

This document details the implementation and verification of the Oracle FCCS MCP Server.

## Implemented Features

### Core Server
- **MCP Server**: Initialized using `@modelcontextprotocol/sdk`.
- **Authentication**: Basic Auth support via `FCCS_USERNAME` and `FCCS_PASSWORD`.
- **Configuration**: Environment variables managed via `dotenv` and validated with `zod`.
- **Mock Mode**: Built-in mock mode for testing without a real FCCS instance (`FCCS_MOCK_MODE=true`).
- **Localization**: Support for Portuguese language in mock mode via `FCCS_LANGUAGE=pt`.

### Tools
The following tools have been implemented and registered:

1.  **`list_applications`**: Lists available applications.
2.  **`get_dimensions`**: Lists dimensions for a specific application.
3.  **`run_mdx_query`**: Executes MDX queries against a specific application.
4.  **`run_consolidation`**: Triggers a consolidation job for a given period/scenario/year.
5.  **`run_business_rule`**: Executes a named business rule with parameters.
6.  **`generate_report`**: Generates a financial report (mocked HTML output).
7.  **`get_job_status`**: Retrieves the status of a submitted job.
8.  **`simulate_transaction`**: Simulates M&A transactions (Acquisition/Divestiture) and their financial impact.

## Remote Server (SSE)

The server is now configured to run as an HTTP server using Server-Sent Events (SSE), which allows for remote connections.

### Running the Server
```bash
npm start
# Output: üöÄ Server running on http://localhost:3000/sse
```

### Connecting from Claude Desktop
To connect Claude Desktop to this remote server, you need to use an SSE-compatible MCP client or proxy. 

If you are running Claude Desktop locally and want to connect to this server running on the same machine (or reachable network):

```json
{
  "mcpServers": {
    "oracle-fccs": {
      "command": "node",
      "args": ["/path/to/epm-cloud/build/index.js"]
    }
  }
}
```
*Note: The above configuration still runs it as a local process. To truly use it remotely, you would typically use an MCP client that supports SSE URLs directly, or run a local proxy that forwards to the SSE URL.*

### SSE Endpoints
- **GET /sse**: Establishes the SSE connection.
- **POST /messages?sessionId={sessionId}**: Sends messages to the server.

## ChatGPT Integration (Custom GPT)

This server now exposes a standard REST API and an OpenAPI schema, making it easy to connect to ChatGPT via **GPT Actions**.

### 1. Expose Server to Internet
To let ChatGPT access your local server, you need to expose it to the internet. You can use **ngrok**:

```bash
# Install ngrok (if not installed)
brew install ngrok/ngrok/ngrok

# Start tunnel to port 3000
ngrok http 3000
```
*Copy the HTTPS URL generated by ngrok (e.g., `https://your-id.ngrok-free.app`).*

### 2. Configure Custom GPT
1.  Go to [ChatGPT](https://chat.openai.com/) > **Explore GPTs** > **Create**.
2.  Go to the **Configure** tab.
3.  Scroll down to **Actions** and click **Create new action**.
4.  In **Import from URL**, paste your ngrok URL followed by `/openapi.json`:
    `https://your-id.ngrok-free.app/openapi.json`
5.  Click **Import**. ChatGPT will automatically detect all tools (Consolidation, MDX, Reports, etc.).
6.  **Authentication**: If you haven't added auth middleware, select "None" (for testing only).

### 3. Test It
You can now ask ChatGPT:
> "Run a consolidation for FCCS_Global for Jan FY24."
> "Simulate an acquisition of TechStartUp for 5M."

## Claude Web (Claude.ai)

**Important**: Currently, **Claude.ai (Web Interface)** does NOT support connecting to local MCP servers directly.

To use this MCP server with Claude, you must use the **Claude Desktop App**:
1.  Download [Claude Desktop](https://claude.ai/download).
2.  Configure it as described in the "Connecting from Claude Desktop" section above.
3.  The Desktop app connects to your local `npm start` process or the SSE endpoint.

## Verification

### Build Verification
The project compiles successfully using TypeScript.
```bash
npm run build
```

### Server Startup
The server starts up and validates connection (or mock mode).
```bash
FCCS_MOCK_MODE=true npm start
```
Expected Output:
```
Starting Oracle FCCS MCP Server...
‚ö†Ô∏è  Running in MOCK MODE
‚úÖ Connected to FCCS instance
üöÄ Server running on stdio
```

### Examples
See [examples.md](file:///Users/ioannisvossos/.gemini/antigravity/brain/8c6f7a09-a70b-4de4-a9f3-c5e69edeb18a/examples.md) for 11 example prompts in English.
See [examples_pt.md](file:///Users/ioannisvossos/.gemini/antigravity/brain/8c6f7a09-a70b-4de4-a9f3-c5e69edeb18a/examples_pt.md) for 10 example prompts in Portuguese.

### Manual Testing
To test the server, you can use an MCP client (like Claude Desktop) configured to run this server.

**Configuration for Claude Desktop (English):**
```json
{
  "mcpServers": {
    "oracle-fccs": {
      "command": "node",
      "args": ["/Users/ioannisvossos/Downloads/epm-cloud/build/index.js"],
      "env": {
        "FCCS_MOCK_MODE": "true"
      }
    }
  }
}
```

**Configuration for Claude Desktop (Portuguese):**
```json
{
  "mcpServers": {
    "oracle-fccs-pt": {
      "command": "node",
      "args": ["/Users/ioannisvossos/Downloads/epm-cloud/build/index.js"],
      "env": {
        "FCCS_MOCK_MODE": "true",
        "FCCS_LANGUAGE": "pt"
      }
    }
  }
}
```
